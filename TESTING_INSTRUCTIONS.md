# üß™ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è BMC Webhooks

## üìã –ö—Ä–æ–∫ 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1.1 –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
```bash
ssh root@65.21.144.234
```

### 1.2 –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
```bash
mkdir -p /root/bmc-test
cd /root/bmc-test
```

### 1.3 –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç
```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ GitHub
wget https://raw.githubusercontent.com/sergeymfo/leo/claude/gh-pages-011CUzDLSCAHphYAxgtu8keL/test_bmc_webhook.py

# –ê–ë–û —è–∫—â–æ –Ω–µ –ø—Ä–∞—Ü—é—î, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É
cat > test_bmc_webhook.py << 'EOF'
[–≤—Å—Ç–∞–≤–∏—Ç–∏ –≤–º—ñ—Å—Ç –∑ test_bmc_webhook.py]
EOF

# –ó—Ä–æ–±–∏—Ç–∏ executable
chmod +x test_bmc_webhook.py
```

### 1.4 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ aiohttp –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```bash
pip3 install aiohttp
# –∞–±–æ
python3 -m pip install aiohttp
```

---

## üìã –ö—Ä–æ–∫ 2: –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ ngrok

### 2.1 –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ ngrok
```bash
cd /root/bmc-test
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
tar -xvzf ngrok-v3-stable-linux-amd64.tgz
chmod +x ngrok
```

### 2.2 (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è –Ω–∞ ngrok
–î–ª—è –±—ñ–ª—å—à —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏:
```bash
# –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://dashboard.ngrok.com/signup
# –û—Ç—Ä–∏–º–∞—Ç–∏ authtoken
# –í–∏–∫–æ–Ω–∞—Ç–∏:
./ngrok config add-authtoken YOUR_AUTHTOKEN
```

**–ú–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏** - –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è –ø—Ä–∞—Ü—é—î –±–µ–∑ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó!

---

## üìã –ö—Ä–æ–∫ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π webhook

### 3.1 –í—ñ–¥–∫—Ä–∏—Ç–∏ 2 SSH —Å–µ—Å—ñ—ó (–∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ tmux/screen)

#### –í–∞—Ä—ñ–∞–Ω—Ç A: –î–≤–∞ –æ–∫—Ä–µ–º–∏—Ö SSH –∑'—î–¥–Ω–∞–Ω–Ω—è

**–¢–µ—Ä–º—ñ–Ω–∞–ª 1 (Webhook Server):**
```bash
ssh root@65.21.144.234
cd /root/bmc-test
python3 test_bmc_webhook.py
```

–ú–∞—î –∑'—è–≤–∏—Ç–∏—Å—è:
```
===================================================================
üöÄ BMC WEBHOOK TEST SERVER
===================================================================
üìç Endpoints:
   POST /bmc-webhook  - BMC webhook handler
   GET  /health       - Health check
‚è≥ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...
```

**–¢–µ—Ä–º—ñ–Ω–∞–ª 2 (ngrok):**
```bash
ssh root@65.21.144.234
cd /root/bmc-test
./ngrok http 8080
```

–ú–∞—î –∑'—è–≤–∏—Ç–∏—Å—è:
```
ngrok

Session Status                online
Forwarding                    https://abc123-xyz.ngrok-free.app -> http://localhost:8080
```

#### –í–∞—Ä—ñ–∞–Ω—Ç B: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ screen (–≤ –æ–¥–Ω–æ–º—É SSH)

```bash
ssh root@65.21.144.234
cd /root/bmc-test

# –°—Ç–≤–æ—Ä–∏—Ç–∏ screen —Å–µ—Å—ñ—é –¥–ª—è webhook
screen -S webhook
python3 test_bmc_webhook.py
# –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ Ctrl+A, –ø–æ—Ç—ñ–º D (detach)

# –°—Ç–≤–æ—Ä–∏—Ç–∏ screen —Å–µ—Å—ñ—é –¥–ª—è ngrok
screen -S ngrok
./ngrok http 8080
# –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ Ctrl+A, –ø–æ—Ç—ñ–º D (detach)

# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏ webhook
screen -r webhook

# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è ngrok URL
screen -r ngrok

# –í–∏–π—Ç–∏ –∑—ñ screen: Ctrl+A, –ø–æ—Ç—ñ–º D
```

---

## üìã –ö—Ä–æ–∫ 4: –û—Ç—Ä–∏–º–∞—Ç–∏ ngrok URL

### 4.1 –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ HTTPS URL

–ó –≤–∏–≤–æ–¥—É ngrok —Å–∫–æ–ø—ñ—é–π—Ç–µ URL:
```
Forwarding    https://abc123-xyz.ngrok-free.app -> http://localhost:8080
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
              –¶–µ–π URL —Ç—Ä–µ–±–∞ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏!
```

### 4.2 –í–∞—à webhook URL –±—É–¥–µ:
```
https://abc123-xyz.ngrok-free.app/bmc-webhook
                                   ^^^^^^^^^^^^
                                   –î–æ–¥–∞—Ç–∏ /bmc-webhook!
```

**–ü—Ä–∏–∫–ª–∞–¥:**
- ngrok URL: `https://7a3b-65-21-144-234.ngrok-free.app`
- Webhook URL: `https://7a3b-65-21-144-234.ngrok-free.app/bmc-webhook`

---

## üìã –ö—Ä–æ–∫ 5: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ webhook –≤ Buy Me a Coffee

### 5.1 –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ BMC dashboard
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ https://www.buymeacoffee.com/webhooks
2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **"Create New Webhook"** (–∞–±–æ "Add Webhook")

### 5.2 –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ–æ—Ä–º—É

**Webhook URL:**
```
https://YOUR-NGROK-URL.ngrok-free.app/bmc-webhook
```
*–ó–∞–º—ñ–Ω–∏—Ç–∏ YOUR-NGROK-URL –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π URL –∑ ngrok*

**Events** (–≤–∏–±—Ä–∞—Ç–∏):
- ‚úÖ **Purchases** (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ñ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏)
- ‚úÖ **Extras** (–ø–æ–∫—É–ø–∫–∞ products - –≤–∞—à –≤–∏–ø–∞–¥–æ–∫!)
- ‚úÖ **Memberships** (–ø—ñ–¥–ø–∏—Å–∫–∏, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

### 5.3 –ó–±–µ—Ä–µ–≥—Ç–∏ webhook
1. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **"Create"** –∞–±–æ **"Save"**
2. **–í–ê–ñ–õ–ò–í–û:** –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ **SECRET KEY** (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑!)
3. –ó–±–µ—Ä–µ–≥—Ç–∏ SECRET KEY –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ

---

## üìã –ö—Ä–æ–∫ 6: –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ webhook

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç–µ—Å—Ç –≤—ñ–¥ BMC

1. –í BMC webhook dashboard –∑–Ω–∞–π—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π webhook
2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **"Send Test"** –∞–±–æ **"Test"**
3. –í –¢–µ—Ä–º—ñ–Ω–∞–ª—ñ 1 –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è:

```
======================================================================
üéâ WEBHOOK –û–¢–†–ò–ú–ê–ù–û!
‚è∞ –ß–∞—Å: 2025-11-10 15:30:00
======================================================================

üì¶ –ü–æ–≤–Ω–∏–π JSON payload:
{
  "response": {
    "supporter_name": "Test User",
    "supporter_email": "test@example.com",
    "total_amount": "5.00",
    ...
  }
}
```

### –¢–µ—Å—Ç 2: –†–µ–∞–ª—å–Ω–∞ –æ–ø–ª–∞—Ç–∞

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –≤–∞—à extra –¥–ª—è $10:
   ```
   https://buymeacoffee.com/fwdr/e/477543
   ```

2. –ó—Ä–æ–±–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –æ–ø–ª–∞—Ç—É (–º–æ–∂–Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—å–æ—é –∫–∞—Ä—Ç–æ—é, BMC –Ω–µ –±–µ—Ä–µ –∫–æ–º—ñ—Å—ñ—é –∑ –ø–µ—Ä—à–∏—Ö $0)
   - –ê–ë–û –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –∫–∞—Ä—Ç–∫—É BMC (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ settings)

3. –ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –≤ –¢–µ—Ä–º—ñ–Ω–∞–ª—ñ 1 –º–∞—î –ø—Ä–∏–π—Ç–∏ webhook –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏

### –¢–µ—Å—Ç 3: Health Check

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î:
```bash
# –ó –≤–∞—à–æ–≥–æ ngrok URL
curl https://YOUR-NGROK-URL.ngrok-free.app/health

# –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏:
{"status": "ok", "message": "BMC Webhook Test Server is running", ...}
```

---

## üîç –©–æ —à—É–∫–∞—Ç–∏ –≤ –ª–æ–≥–∞—Ö

### ‚úÖ –£—Å–ø—ñ—à–Ω–∏–π webhook:

```
======================================================================
üéâ WEBHOOK –û–¢–†–ò–ú–ê–ù–û!
‚è∞ –ß–∞—Å: 2025-11-10 15:30:00
======================================================================

üì¶ –ü–æ–≤–Ω–∏–π JSON payload:
{
  "response": {
    "supporter_name": "Ivan Petrov",
    "supporter_email": "ivan@example.com",
    "total_amount": "10.00",
    "support_note": "–î—è–∫—É—é!",
    "support_created_on": "2025-11-10 15:30:00",
    "number_of_coffees": "2"
  }
}

‚úÖ –†–æ–∑—ñ–±—Ä–∞–Ω—ñ –¥–∞–Ω—ñ:
   üë§ –Ü–º'—è: Ivan Petrov
   üìß Email: ivan@example.com
   üí∞ –°—É–º–∞: $10.00
   üí¨ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –î—è–∫—É—é!
   üìÖ –î–∞—Ç–∞: 2025-11-10 15:30:00
   ‚òï –ö—ñ–ª—å–∫—ñ—Å—Ç—å: 2
======================================================================
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∏:

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å**
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ ngrok –ø—Ä–∞—Ü—é—î
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ webhook server –ø—Ä–∞—Ü—é—î
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ URL –≤ BMC (–º–∞—î –±—É—Ç–∏ HTTPS + /bmc-webhook)

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ–º–∏–ª–∫–∞ JSON**
- –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –ø–æ–≤–Ω–∏–π payload –≤ –ª–æ–≥–∞—Ö
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö

**–ü—Ä–æ–±–ª–µ–º–∞ 3: ngrok —Ç—É–Ω–µ–ª—å –∑–∞–∫—Ä–∏–≤—Å—è**
- –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è ngrok –∑–∞–∫—Ä–∏–≤–∞—î —Ç—É–Ω–µ–ª—å —á–µ—Ä–µ–∑ 2 –≥–æ–¥–∏–Ω–∏
- –¢—Ä–µ–±–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ ngrok
- URL –∑–º—ñ–Ω–∏—Ç—å—Å—è! –û–Ω–æ–≤–∏—Ç–∏ –≤ BMC dashboard

---

## üõë –ó—É–ø–∏–Ω–∏—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ó—É–ø–∏–Ω–∏—Ç–∏ webhook server:
```bash
# –Ø–∫—â–æ –∑–∞–ø—É—Å–∫–∞–ª–∏ –Ω–∞–ø—Ä—è–º—É
Ctrl+C –≤ Terminal 1

# –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ screen
screen -r webhook
Ctrl+C
exit
```

### –ó—É–ø–∏–Ω–∏—Ç–∏ ngrok:
```bash
# –Ø–∫—â–æ –∑–∞–ø—É—Å–∫–∞–ª–∏ –Ω–∞–ø—Ä—è–º—É
Ctrl+C –≤ Terminal 2

# –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ screen
screen -r ngrok
Ctrl+C
exit
```

### –í–∏–¥–∞–ª–∏—Ç–∏ webhook –∑ BMC:
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://www.buymeacoffee.com/webhooks
2. –ó–Ω–∞–π—Ç–∏ webhook
3. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "Delete"

---

## ‚úÖ –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç—É

–ö–æ–ª–∏ webhook –ø—Ä–∞—Ü—é—î —ñ –≤–∏ –±–∞—á–∏—Ç–µ –¥–∞–Ω—ñ –≤ –ª–æ–≥–∞—Ö:

1. **–ó–±–µ—Ä–µ–≥—Ç–∏ SECRET KEY** –∑ BMC
2. **–Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ –æ—Å–Ω–æ–≤–Ω–∏–π –±–æ—Ç:**
   - –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `bmc_webhook_handler.py` –∑ –ø–∞–ø–∫–∏
   - –î–æ–¥–∞—Ç–∏ SECRET KEY –≤ `.env` —Ñ–∞–π–ª
   - –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ production webhook URL (–∑ –¥–æ–º–µ–Ω–æ–º + SSL)

3. **–î–ª—è production –ø–æ—Ç—Ä—ñ–±–Ω–æ:**
   - –î–æ–º–µ–Ω –∑ SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º (Let's Encrypt)
   - Nginx –¥–ª—è –ø—Ä–æ–∫—Å—É–≤–∞–Ω–Ω—è
   - Systemd service –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É
   - –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–ª—è pending_payments

---

## üìù –®–≤–∏–¥–∫—ñ –∫–æ–º–∞–Ω–¥–∏ (—à–ø–∞—Ä–≥–∞–ª–∫–∞)

```bash
# –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è
ssh root@65.21.144.234
cd /root/bmc-test

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ webhook (background)
nohup python3 test_bmc_webhook.py > webhook.log 2>&1 &

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ ngrok
./ngrok http 8080

# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –ª–æ–≥–∏ webhook
tail -f webhook.log

# –ó—É–ø–∏–Ω–∏—Ç–∏ webhook
pkill -f test_bmc_webhook.py

# –ó—É–ø–∏–Ω–∏—Ç–∏ ngrok
pkill ngrok
```

---

## üÜò Troubleshooting

### –ü–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π (Address already in use)
```bash
# –ó–Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –ø–æ—Ä—Ç—É 8080
lsof -i :8080
# –∞–±–æ
netstat -tulpn | grep 8080

# –í–±–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å
kill -9 PID
```

### ngrok –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é
./ngrok version

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å
curl https://ngrok.com

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ª–æ–∫altunnel
npm install -g localtunnel
lt --port 8080
```

### aiohttp –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```bash
pip3 install aiohttp
# –∞–±–æ
python3 -m pip install --user aiohttp
```

---

## üéØ –©–æ –≤–≤–æ–¥–∏—Ç–∏ –≤ BMC webhook URL?

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
```
https://7a3b-65-21-144-234.ngrok-free.app/bmc-webhook
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
```
http://65.21.144.234:8080/bmc-webhook        (HTTP, –Ω–µ HTTPS)
https://65.21.144.234:8080/bmc-webhook       (IP –±–µ–∑ SSL)
https://7a3b-65-21-144-234.ngrok-free.app    (–±–µ–∑ /bmc-webhook)
http://localhost:8080/bmc-webhook             (localhost)
```

---

üéâ **–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ BMC webhooks!**
